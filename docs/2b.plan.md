# Feat_2b: Consolidación de Transacciones en Fichero de Portfolio – Plan de Implementación

## Objetivo

Migrar el almacenamiento de transacciones desde ficheros individuales a un único array `transactions` dentro de cada fichero de portfolio, mejorando rendimiento de lectura y mantenimiento.

## Tareas

- [ ] Definir la estructura extendida de `Portfolio`  
  - Agregar propiedad `transactions: Transaction[]` en el tipo de datos.
  - Actualizar `trading.types.ts` con el nuevo alias de tipo.

- [ ] Refactorizar `createTransactionRepository`  
  - Leer el JSON de portfolio correspondiente (`{portfolioId}.json`).
  - Añadir la nueva transacción a `portfolio.transactions`.
  - Volver a escribir el fichero completo del portfolio.

- [ ] Adaptar `getTransactionsByPortfolioRepository`  
  - Leer directamente `transactions` desde el fichero de portfolio.
  - Eliminar lógica de escaneo de directorio de transacciones.

- [ ] Ajustar `getPortfolioHoldingsRepository`  
  - Iterar sobre `portfolio.transactions` para calcular holdings.
  - Eliminar dependencia de múltiples lecturas de ficheros.

- [ ] Gestionar errores y validaciones  
  - Comprobar existencia y formato del fichero de portfolio.
  - Manejar condiciones de carrera (lectura/escritura concurrente).
  - Añadir early returns y mensajes claros en caso de fallo.

- [ ] Script de migración de datos existentes (opcional)  
  - Recorrer todos los ficheros de transacción individuales.
  - Agruparlos en el array `transactions` de cada portfolio.
  - Eliminar ficheros individuales tras migración.

